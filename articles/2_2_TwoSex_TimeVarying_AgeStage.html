<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Two-sex time-varying kinship model specified by age and stage • DemoKin</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Two-sex time-varying kinship model specified by age and stage">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">DemoKin</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>

  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tutorials

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/1_1_OneSex_TimeInvariant_Age.html">One-sex time-invariant model</a>
    </li>
    <li>
      <a href="../articles/1_2_OneSex_TimeVarying_Age.html">One-sex time-varying model</a>
    </li>
    <li>
      <a href="../articles/1_3_TwoSex_TimeInvariant_Age.html">Two-sex time-invariant model</a>
    </li>
    <li>
      <a href="../articles/1_4_TwoSex_TimeVarying_Age.html">Two-sex time-varying model</a>
    </li>
    <li>
      <a href="../articles/2_1_OneSex_TimeInvariant_AgeStage.html">One-sex time-invariant Age-Stage model</a>
    </li>
    <li>
      <a href="../articles/2_2_TwoSex_TimeVarying_AgeStage.html">Two-sex time-varying Age-Stage model</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../articles/0_0_Papers.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/IvanWilli/DemoKin" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Two-sex time-varying kinship model specified by
age and stage</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/IvanWilli/DemoKin/blob/main/vignettes/2_2_TwoSex_TimeVarying_AgeStage.Rmd" class="external-link"><code>vignettes/2_2_TwoSex_TimeVarying_AgeStage.Rmd</code></a></small>
      <div class="hidden name"><code>2_2_TwoSex_TimeVarying_AgeStage.Rmd</code></div>

    </div>

    
    
<style>
/* Make TOC appear on the right side */
.tocify {
  position: fixed;
  top: 50px;
  right: 0;
  width: 240px;
  height: calc(100% - 50px);
  overflow-y: auto;
  margin-left: 0;
  padding-left: 0;
}

/* Adjust main content to make room for right-side TOC */
.main-container {
  max-width: calc(100% - 260px);
  margin-left: 10px;
  margin-right: 250px;
}

/* Limit TOC to only show 2 levels */
.tocify-subheader .tocify-subheader {
  display: none;
}

/* Style for learning objectives box */
.learning-objectives {
  background-color: #e0f7fa;
  border-left: 5px solid #00acc1;
  padding: 15px;
  margin-bottom: 20px;
  border-radius: 3px;
}
</style>
<div class="learning-objectives">
<p><strong>Learning Objectives</strong>: In this vignette, you will
learn how to implement a kinship model that combines both two-sex and
time-varying approaches with multiple stages. You will understand how to
incorporate sex-specific demographic rates that change over time,
analyze the effects of demographic transitions on kinship structures by
sex and stage, and explore applications with different stage variables
such as parity and education.</p>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this final vignette, we integrate all elements from previous
tutorials into the most comprehensive kinship model available: a
<strong>two-sex time-varying multi-state model</strong>. This framework
simultaneously accounts for:</p>
<ul>
<li>Sex differences in demographic rates</li>
<li>Historical changes over time</li>
<li>Stage-based transitions (like parity or education)</li>
<li>Joint distributions of age, sex, and stage among relatives</li>
</ul>
<p>Building on previous Caswell and colleagues’ theoretical developments
<span class="citation">(2019, 2020, 2022; 2021)</span>, Butterick and
others <span class="citation">(2025)</span> created an integral approach
providing unprecedented analytical power for understanding complex
family structures. We’ll apply this comprehensive model using the
<code>kin_multi_stage_time_variant_2sex</code> function, exploring two
examples: one using parity and another using educational attainment to
demonstrate how these models illuminate contemporary family dynamics in
ways simpler models cannot.</p>
<div class="section level3">
<h3 id="preparation">Package Installation<a class="anchor" aria-label="anchor" href="#preparation"></a>
</h3>
<p>If you haven’t already installed the required packages from the
previous vignettes, here’s what you’ll need:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install basic data analysis packages</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"dplyr"</span><span class="op">)</span>     <span class="co"># Data manipulation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"tidyr"</span><span class="op">)</span>     <span class="co"># Data tidying</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"ggplot2"</span><span class="op">)</span>   <span class="co"># Data visualization</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"knitr"</span><span class="op">)</span>     <span class="co"># Document generation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"Matrix"</span><span class="op">)</span>    <span class="co"># Matrix operations</span></span>
<span></span>
<span><span class="co"># Install DemoKin</span></span>
<span><span class="co"># DemoKin is available on CRAN (https://cran.r-project.org/web/packages/DemoKin/index.html), </span></span>
<span><span class="co"># but we'll use the development version on GitHub (https://github.com/IvanWilli/DemoKin):</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"IvanWilli/DemoKin"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/IvanWilli/DemoKin" class="external-link">DemoKin</a></span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="load-packages">Setting Up the Analysis Environment<a class="anchor" aria-label="anchor" href="#load-packages"></a>
</h2>
<p>Let’s load the necessary packages for our analysis:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>    <span class="co"># For data manipulation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span>    <span class="co"># For restructuring data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>  <span class="co"># For visualization</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span>    <span class="co"># For document generation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://Matrix.R-forge.R-project.org" class="external-link">Matrix</a></span><span class="op">)</span>   <span class="co"># For matrix operations</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>dplyr.summarise.inform <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># hide summarise output</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="two-sex-time-varying-multi-state">Two-Sex Time-Varying Multi-State Models<a class="anchor" aria-label="anchor" href="#two-sex-time-varying-multi-state"></a>
</h2>
<p>The <code>kin_multi_stage_time_variant_2sex</code> function in the
<code>DemoKin</code> package allows us to implement a comprehensive
kinship model that accounts for sex, time, and stage simultaneously.
This function computes stage-specific kinship networks across both sexes
for an average member of a population (focal) under time-varying
demographic rates.</p>
<p>The model estimates:</p>
<ul>
<li>The number of relatives of each type</li>
<li>The age distribution of relatives</li>
<li>The sex distribution of relatives</li>
<li>The stage distribution of relatives</li>
<li>How these distributions change over the life course of Focal</li>
<li>How they vary by Focal’s birth cohort</li>
</ul>
<div class="section level3">
<h3 id="model-requirements">Model Components and Requirements<a class="anchor" aria-label="anchor" href="#model-requirements"></a>
</h3>
<p>The two-sex time-varying multi-state model requires several
inputs:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Sex-specific mortality rates by stage over time</strong>:
How survival probabilities differ between males and females of different
stages across historical periods</li>
<li>
<strong>Sex-specific fertility rates by stage over time</strong>:
How fertility patterns differ between males and females of different
stages across historical periods</li>
<li>
<strong>Sex-specific transition rates between stages over
time</strong>: How individuals move between stages at each age,
potentially differing by sex</li>
<li>
<strong>Sex ratio at birth</strong>: The proportion of births that
are female</li>
<li>
<strong>Birth redistribution matrices</strong>: How newborns are
distributed across stages</li>
<li>
<strong>Sex and initial stage of the focal individual</strong>: The
characteristics of the person whose kin network we’re analyzing</li>
</ol>
<p>In the following sections, we’ll explore two examples of this model
using different stage variables: parity and education.</p>
</div>
</div>
<div class="section level2">
<h2 id="parity-as-stage">Example 1: Parity as the Stage Variable<a class="anchor" aria-label="anchor" href="#parity-as-stage"></a>
</h2>
<div class="section level3">
<h3 id="parity-data-preparation">Data Preparation<a class="anchor" aria-label="anchor" href="#parity-data-preparation"></a>
</h3>
<p>In our first example, we’ll use parity (number of children already
born) as our stage variable. We’ll use data from the United Kingdom
ranging from 1965 to 2022, sourced from the Human Mortality Database and
the Office for National Statistics.</p>
<p>Due to data limitations, we make some simplifying assumptions:</p>
<ol style="list-style-type: decimal">
<li>Fertility rates vary with time and parity but are the same across
sexes (the “androgynous approximation”)</li>
<li>Mortality rates vary with time and sex but are the same across
parity classes</li>
<li>Parity progression probabilities vary with time but are the same
across sexes</li>
</ol>
<p>Let’s load the pre-processed UK data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load pre-processed data for UK</span></span>
<span><span class="va">F_mat_fem</span> <span class="op">&lt;-</span> <span class="va">Female_parity_fert_list_UK</span>       <span class="co"># Female fertility by parity</span></span>
<span><span class="va">F_mat_male</span> <span class="op">&lt;-</span> <span class="va">Female_parity_fert_list_UK</span>      <span class="co"># Male fertility (same as female due to androgynous approximation)</span></span>
<span><span class="va">T_mat_fem</span> <span class="op">&lt;-</span> <span class="va">Parity_transfers_by_age_list_UK</span>  <span class="co"># Female parity transitions</span></span>
<span><span class="va">T_mat_male</span> <span class="op">&lt;-</span> <span class="va">Parity_transfers_by_age_list_UK</span> <span class="co"># Male parity transitions (same as female)</span></span>
<span><span class="va">U_mat_fem</span> <span class="op">&lt;-</span> <span class="va">Female_parity_mortality_list_UK</span>  <span class="co"># Female survival</span></span>
<span><span class="va">U_mat_male</span> <span class="op">&lt;-</span> <span class="va">Male_parity_mortality_list_UK</span>   <span class="co"># Male survival</span></span>
<span><span class="va">H_mat</span> <span class="op">&lt;-</span> <span class="va">Redistribution_by_parity_list_UK</span>     <span class="co"># Birth redistribution matrices</span></span></code></pre></div>
<p>These lists contain period-specific demographic rates:</p>
<ul>
<li>
<code>U_mat_fem</code>/<code>U_mat_male</code>: Lists of matrices
containing survival probabilities by age (rows) and parity (columns)
from 1965-2022</li>
<li>
<code>F_mat_fem</code>/<code>F_mat_male</code>: Lists of matrices
containing fertility rates by age and parity</li>
<li>
<code>T_mat_fem</code>/<code>T_mat_male</code>: Lists of transition
matrices showing probabilities of moving between parity states</li>
<li>
<code>H_mat</code>: List of matrices that redistribute newborns to
age-class 1 and parity 0</li>
</ul>
</div>
<div class="section level3">
<h3 id="parity-model-running">Running the Parity Model<a class="anchor" aria-label="anchor" href="#parity-model-running"></a>
</h3>
<p>Now let’s implement the two-sex time-varying multi-state model with
parity as the stage variable:</p>
<blockquote>
<p>Note: This model run takes approximately 30 minutes to complete, so
we let to the reader its run.</p>
</blockquote>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define time period and parameters</span></span>
<span><span class="va">no_years</span> <span class="op">&lt;-</span> <span class="fl">40</span>  <span class="co"># Run the model for 40 years (1965-2005)</span></span>
<span></span>
<span><span class="co"># Run the model</span></span>
<span><span class="va">kin_out_1965_2005</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/kin_multi_stage_time_variant_2sex.html">kin_multi_stage_time_variant_2sex</a></span><span class="op">(</span></span>
<span>    U_list_females <span class="op">=</span> <span class="va">U_mat_fem</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">no_years</span><span class="op">)</span><span class="op">]</span>,        <span class="co"># Female survival matrices</span></span>
<span>    U_list_males <span class="op">=</span> <span class="va">U_mat_male</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">no_years</span><span class="op">)</span><span class="op">]</span>,         <span class="co"># Male survival matrices</span></span>
<span>    F_list_females <span class="op">=</span> <span class="va">F_mat_fem</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">no_years</span><span class="op">)</span><span class="op">]</span>,        <span class="co"># Female fertility matrices</span></span>
<span>    F_list_males <span class="op">=</span> <span class="va">F_mat_male</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">no_years</span><span class="op">)</span><span class="op">]</span>,         <span class="co"># Male fertility matrices</span></span>
<span>    T_list_females <span class="op">=</span> <span class="va">T_mat_fem</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">no_years</span><span class="op">)</span><span class="op">]</span>,        <span class="co"># Female transition matrices</span></span>
<span>    T_list_males <span class="op">=</span> <span class="va">T_mat_fem</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">no_years</span><span class="op">)</span><span class="op">]</span>,          <span class="co"># Male transition matrices</span></span>
<span>    H_list <span class="op">=</span> <span class="va">H_mat</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">no_years</span><span class="op">)</span><span class="op">]</span>,                    <span class="co"># Birth redistribution matrices</span></span>
<span>    birth_female <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="fl">0.51</span>,                           <span class="co"># UK sex ratio (49% female)</span></span>
<span>    parity <span class="op">=</span> <span class="cn">TRUE</span>,                                      <span class="co"># Stages represent parity</span></span>
<span>    output_kin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"d"</span>, <span class="st">"oa"</span>, <span class="st">"ys"</span>, <span class="st">"os"</span><span class="op">)</span>,             <span class="co"># Selected kin types</span></span>
<span>    summary_kin <span class="op">=</span> <span class="cn">TRUE</span>,                                 <span class="co"># Produce summary statistics</span></span>
<span>    sex_Focal <span class="op">=</span> <span class="st">"Female"</span>,                               <span class="co"># Focal is female</span></span>
<span>    initial_stage_Focal <span class="op">=</span> <span class="fl">1</span>,                            <span class="co"># Focal starts at parity 0</span></span>
<span>    <span class="co"># model_years &lt;- seq(1965, 2005, 5),                     # the sequence of years we model</span></span>
<span>    output_years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1965</span>, <span class="fl">1975</span>, <span class="fl">1985</span>, <span class="fl">1995</span>, <span class="fl">2005</span><span class="op">)</span>     <span class="co"># Selected output years</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Now we need to recode the stage variables to show meaningful parity
labels:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># After running the model, recode the parity stage values</span></span>
<span><span class="va">kin_out_1965_2005</span><span class="op">$</span><span class="va">kin_summary</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">kin_out_1965_2005</span><span class="op">$</span><span class="va">kin_summary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>stage_kin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">stage_kin</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>, </span>
<span>                           levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>                           labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>, <span class="st">"5+"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Do the same for the kin_full dataframe if you're using it</span></span>
<span><span class="va">kin_out_1965_2005</span><span class="op">$</span><span class="va">kin_full</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">kin_out_1965_2005</span><span class="op">$</span><span class="va">kin_full</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>stage_kin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">stage_kin</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>, </span>
<span>                           levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>                           labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>, <span class="st">"5+"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="parity-kin-counts">Analyzing Kin Counts by Parity<a class="anchor" aria-label="anchor" href="#parity-kin-counts"></a>
</h3>
<p>Let’s examine the structure of the output:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">kin_out_1965_2005</span><span class="op">$</span><span class="va">kin_summary</span><span class="op">)</span></span></code></pre></div>
<p>The output includes:</p>
<ul>
<li>
<code>age_focal</code>: Age of the focal individual</li>
<li>
<code>kin_stage</code>: Stage (parity) of the relatives</li>
<li>
<code>sex_kin</code>: Sex of the relatives</li>
<li>
<code>year</code>: Calendar year of observation</li>
<li>
<code>group</code>: Type of relative (d = children, oa = older
aunts/uncles, etc.)</li>
<li>
<code>count</code>: Expected number of living relatives</li>
<li>
<code>cohort</code>: Birth cohort of the focal individual</li>
</ul>
<div class="section level4">
<h4 id="parity-period-analysis">Period Analysis of Kin by Parity<a class="anchor" aria-label="anchor" href="#parity-period-analysis"></a>
</h4>
<p>Let’s visualize the distribution of older aunts and uncles by parity
for different ages of Focal across different calendar years.</p>
<p>We first restrict Focal’s kinship network to aunts and uncles older
than Focal’s mother by setting <code>group</code> == “oa”. We visualize
the marginal parity distributions of kin: <code>stage_kin</code>, for
each age of Focal <code>age_focal</code>, using different color schemes.
Implicit in the below plot is that we really plot Focal’s born into
different <code>cohort</code> – i.e., in the 2005 panel we show a 50
year old Focal was born in 1955, while a 40 year old Focal was born in
1965.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kin_out_1965_2005</span><span class="op">$</span><span class="va">kin_summary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">group</span> <span class="op">==</span> <span class="st">"oa"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age_focal</span>, y <span class="op">=</span> <span class="va">count</span>, color <span class="op">=</span> <span class="va">stage_kin</span>, fill <span class="op">=</span> <span class="va">stage_kin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"stack"</span>, stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">sex_kin</span> <span class="op">~</span> <span class="va">year</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">30</span>,<span class="fl">40</span>,<span class="fl">50</span>,<span class="fl">60</span>,<span class="fl">70</span>,<span class="fl">80</span>,<span class="fl">90</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Parity distribution of older aunts and uncles by Focal's age"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"United Kingdom, 1965-2005"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Age of focal individual"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Number of older aunts and uncles"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Parity"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Parity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>We could also consider any other kin in Focal’s network, for
instance, offspring using <code>group</code> == “d”:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kin_out_1965_2005</span><span class="op">$</span><span class="va">kin_summary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">group</span> <span class="op">==</span> <span class="st">"d"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age_focal</span>, y <span class="op">=</span> <span class="va">count</span>, color <span class="op">=</span> <span class="va">stage_kin</span>, fill <span class="op">=</span> <span class="va">stage_kin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"stack"</span>, stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">sex_kin</span> <span class="op">~</span> <span class="va">year</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">30</span>,<span class="fl">40</span>,<span class="fl">50</span>,<span class="fl">60</span>,<span class="fl">70</span>,<span class="fl">80</span>,<span class="fl">90</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Parity distribution of children by Focal's age"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"United Kingdom, 1965-2005"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Age of focal individual"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Number of children"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Parity"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Parity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="parity-cohort-analysis">Cohort Analysis of Kin by Parity<a class="anchor" aria-label="anchor" href="#parity-cohort-analysis"></a>
</h4>
<p>Since we only ran the model for 40 years (between 1965-2005), there
is very little scope to view kinship as cohort-specific.</p>
<p>We can however compare cohorts for 40-year segments of Focal’s life.
Below, following from the above example, we once again consider
offspring and only show Focals born of <code>cohort</code> 1910, 1925,
or 1965:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kin_out_1965_2005</span><span class="op">$</span><span class="va">kin_summary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">group</span> <span class="op">==</span> <span class="st">"d"</span>, <span class="va">cohort</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1910</span>, <span class="fl">1925</span>, <span class="fl">1965</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age_focal</span>, y <span class="op">=</span> <span class="va">count</span>, color <span class="op">=</span> <span class="va">stage_kin</span>, fill <span class="op">=</span> <span class="va">stage_kin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"stack"</span>, stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">sex_kin</span> <span class="op">~</span> <span class="va">cohort</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Parity distribution of offspring by birth cohort"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"United Kingdom, ages observed between 1965-2005"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Age of focal individual"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Number of offspring"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Parity"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Parity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><strong>Interpretation</strong>:</p>
<ul>
<li>The 1910 cohort (observed at ages 55-95): Most offspring have
already completed their childbearing, showing a mix of parity
states</li>
<li>The 1925 cohort (observed at ages 40-80): Offspring are observed
during and after their reproductive years</li>
<li>The 1965 cohort (observed at ages 0-40): Initially, all offspring
are in parity 0, gradually transitioning to higher parities as they
age</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="parity-age-distribution">Age Distribution of Kin by Parity<a class="anchor" aria-label="anchor" href="#parity-age-distribution"></a>
</h3>
<p>For more detailed analysis, we can examine the age and parity
distribution of specific relatives. Let’s look at the younger siblings
of a 50-year-old Focal across different years:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kin_out_1965_2005</span><span class="op">$</span><span class="va">kin_full</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">group</span> <span class="op">==</span> <span class="st">"ys"</span>,</span>
<span>         <span class="va">age_focal</span> <span class="op">==</span> <span class="fl">50</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age_kin</span>, y <span class="op">=</span> <span class="va">count</span>, color <span class="op">=</span> <span class="va">stage_kin</span>, fill <span class="op">=</span> <span class="va">stage_kin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"stack"</span>, stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">sex_kin</span> <span class="op">~</span> <span class="va">year</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">30</span>,<span class="fl">40</span>,<span class="fl">50</span>,<span class="fl">60</span>,<span class="fl">70</span>,<span class="fl">80</span>,<span class="fl">90</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Age and parity distribution of younger siblings"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"For a 50-year-old focal individual, United Kingdom, 1965-2005"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Age of sibling"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Number of younger siblings"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Parity"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Parity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Notice the discontinuity along the x-axis at age 50. This reflects
the fact that younger siblings cannot be older than Focal (by
definition). Similarly, when we examine older siblings, we’ll see they
cannot be younger than Focal.</p>
<p>With a simple manipulation of the output data frame, we can also plot
the age and parity distribution of all siblings combined:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kin_out_1965_2005</span><span class="op">$</span><span class="va">kin_full</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">(</span><span class="va">group</span> <span class="op">==</span> <span class="st">"ys"</span> <span class="op">|</span> <span class="va">group</span> <span class="op">==</span> <span class="st">"os"</span><span class="op">)</span>,</span>
<span>         <span class="va">age_focal</span> <span class="op">==</span> <span class="fl">50</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">group</span>, values_from <span class="op">=</span> <span class="va">count</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>count <span class="op">=</span> <span class="va">`ys`</span> <span class="op">+</span> <span class="va">`os`</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age_kin</span>, y <span class="op">=</span> <span class="va">count</span>, color <span class="op">=</span> <span class="va">stage_kin</span>, fill <span class="op">=</span> <span class="va">stage_kin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"stack"</span>, stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">sex_kin</span> <span class="op">~</span> <span class="va">year</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">30</span>,<span class="fl">40</span>,<span class="fl">50</span>,<span class="fl">60</span>,<span class="fl">70</span>,<span class="fl">80</span>,<span class="fl">90</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Age and parity distribution of all siblings"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"For a 50-year-old focal individual, United Kingdom, 1965-2005"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Age of sibling"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Number of siblings"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Parity"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Parity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="education-as-stage">Example 2: Education as the Stage Variable<a class="anchor" aria-label="anchor" href="#education-as-stage"></a>
</h2>
<div class="section level3">
<h3 id="education-data-preparation">Data Preparation<a class="anchor" aria-label="anchor" href="#education-data-preparation"></a>
</h3>
<p>In our second example, we’ll use educational attainment as our stage
variable. The data is for Singapore ranging from 2020 to 2090, sourced
from the Wittgenstein Center. The data is aggregated into 5-year age
groups and 5-year time intervals.</p>
<p>Some simplifying assumptions we make due to data availability:</p>
<ol style="list-style-type: decimal">
<li>Fertility rates vary with time and education but are identical for
both sexes (androgynous approximation)</li>
<li>Age-specific education transition probabilities vary over time but
not by sex</li>
<li>Educational transitions for young children follow Singapore’s
Compulsory Education Act</li>
<li>Demographic rates before 2020 are assumed stable
(time-invariant)</li>
</ol>
<p>Let’s load the pre-processed Singapore data:</p>
<p>This data includes:</p>
<ul>
<li>
<code>U_mat_fem_edu</code>/<code>U_mat_male_edu</code>: Lists of
matrices containing survival probabilities by age (rows) and education
(columns) from 2020-2090</li>
<li>
<code>F_mat_fem_edu</code>/<code>F_mat_male_edu</code>: Lists of
matrices containing fertility rates by age and education</li>
<li>
<code>T_mat_fem_edu</code>/<code>T_mat_male_edu</code>: Lists of
transition matrices showing probabilities of moving between education
states</li>
<li>
<code>H_mat_edu</code>: List of matrices that redistribute newborns
to age-class 1 and “no education” category</li>
</ul>
<p>Before running the model, let’s examine some trends in the data:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate and plot Total Fertility Rate by education level over time</span></span>
<span><span class="va">tfr_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">F_mat_fem_edu</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">col_sums</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums-methods.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">F_mat_fem_edu</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    year <span class="op">=</span> <span class="fl">2020</span> <span class="op">+</span> <span class="op">(</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fl">5</span>,</span>
<span>    education <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">F_mat_fem_edu</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, </span>
<span>                      levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"e1"</span>, <span class="st">"e2"</span>, <span class="st">"e3"</span>, <span class="st">"e4"</span>, <span class="st">"e5"</span>, <span class="st">"e6"</span><span class="op">)</span>,</span>
<span>                      labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"no education"</span>, <span class="st">"incomplete primary"</span>, </span>
<span>                                <span class="st">"primary"</span>, <span class="st">"lower secondary"</span>, </span>
<span>                                <span class="st">"upper secondary"</span>, <span class="st">"post-secondary"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    tfr <span class="op">=</span> <span class="va">col_sums</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tfr_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">tfr_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot TFR trends</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">tfr_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">tfr</span>, color <span class="op">=</span> <span class="va">education</span>, group <span class="op">=</span> <span class="va">education</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Total Fertility Rate by Education Over Time"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"TFR"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Education"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="2_2_TwoSex_TimeVarying_AgeStage_files/figure-html/edu_trends-1.png" width="2400" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="education-model-running">Running the Education Model<a class="anchor" aria-label="anchor" href="#education-model-running"></a>
</h3>
<p>Now let’s implement the two-sex time-varying multi-state model with
education as the stage variable:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define time period and parameters</span></span>
<span><span class="va">time_range</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2020</span>, <span class="fl">2090</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">no_years</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">time_range</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="va">output_year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">no_years</span> <span class="op">+</span> <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run the model</span></span>
<span><span class="va">kin_out_2020_2090</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/kin_multi_stage_time_variant_2sex.html">kin_multi_stage_time_variant_2sex</a></span><span class="op">(</span></span>
<span>    U_list_females <span class="op">=</span> <span class="va">U_mat_fem_edu</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">no_years</span><span class="op">)</span><span class="op">]</span>,     <span class="co"># Female survival matrices</span></span>
<span>    U_list_males <span class="op">=</span> <span class="va">U_mat_male_edu</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">no_years</span><span class="op">)</span><span class="op">]</span>,      <span class="co"># Male survival matrices</span></span>
<span>    F_list_females <span class="op">=</span> <span class="va">F_mat_fem_edu</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">no_years</span><span class="op">)</span><span class="op">]</span>,     <span class="co"># Female fertility matrices</span></span>
<span>    F_list_males <span class="op">=</span> <span class="va">F_mat_male_edu</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">no_years</span><span class="op">)</span><span class="op">]</span>,      <span class="co"># Male fertility matrices</span></span>
<span>    T_list_females <span class="op">=</span> <span class="va">T_mat_fem_edu</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">no_years</span><span class="op">)</span><span class="op">]</span>,     <span class="co"># Female transition matrices</span></span>
<span>    T_list_males <span class="op">=</span> <span class="va">T_mat_fem_edu</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">no_years</span><span class="op">)</span><span class="op">]</span>,       <span class="co"># Male transition matrices</span></span>
<span>    H_list <span class="op">=</span> <span class="va">H_mat_edu</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">no_years</span><span class="op">)</span><span class="op">]</span>,                 <span class="co"># Birth redistribution matrices</span></span>
<span>    birth_female <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1.06</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>,                          <span class="co"># Singapore sex ratio (48.5% female)</span></span>
<span>    parity <span class="op">=</span> <span class="cn">FALSE</span>,                                      <span class="co"># Stages represent education</span></span>
<span>    summary_kin <span class="op">=</span> <span class="cn">TRUE</span>,                                  <span class="co"># Produce summary statistics</span></span>
<span>    sex_Focal <span class="op">=</span> <span class="st">"Female"</span>,                                <span class="co"># Focal is female</span></span>
<span>    initial_stage_Focal <span class="op">=</span> <span class="fl">1</span>,                             <span class="co"># Focal starts with no education</span></span>
<span>    output_years <span class="op">=</span> <span class="va">output_year</span>                           <span class="co"># All years</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 46.908 sec elapsed</span></span></code></pre>
<blockquote>
<p>Note: This model run takes approximately 3 minutes to complete.</p>
</blockquote>
<p>Now we need to recode the stage variables to show meaningful
educational labels and convert years/ages to real values (since we used
5-year intervals):</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Recode year and age variables to show correct values</span></span>
<span><span class="va">kin_out_2020_2090</span><span class="op">$</span><span class="va">kin_summary</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">kin_out_2020_2090</span><span class="op">$</span><span class="va">kin_summary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="op">(</span><span class="va">year</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fl">5</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">time_range</span><span class="op">)</span>,</span>
<span>         age_focal <span class="op">=</span> <span class="va">age_focal</span><span class="op">*</span><span class="fl">5</span>,</span>
<span>         cohort <span class="op">=</span> <span class="va">year</span> <span class="op">-</span> <span class="va">age_focal</span>,</span>
<span>         stage_kin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">stage_kin</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span>,</span>
<span>                       labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>                         <span class="st">"no education"</span>,</span>
<span>                         <span class="st">"incomplete primary"</span>,</span>
<span>                         <span class="st">"primary"</span>,</span>
<span>                         <span class="st">"lower secondary"</span>,</span>
<span>                         <span class="st">"upper secondary"</span>,</span>
<span>                         <span class="st">"post-secondary"</span></span>
<span>                       <span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">kin_out_2020_2090</span><span class="op">$</span><span class="va">kin_full</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">kin_out_2020_2090</span><span class="op">$</span><span class="va">kin_full</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="op">(</span><span class="va">year</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fl">5</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">time_range</span><span class="op">)</span>,</span>
<span>         age_focal <span class="op">=</span> <span class="va">age_focal</span><span class="op">*</span><span class="fl">5</span>,</span>
<span>         age_kin <span class="op">=</span> <span class="va">age_kin</span><span class="op">*</span><span class="fl">5</span>,</span>
<span>         cohort <span class="op">=</span> <span class="va">year</span> <span class="op">-</span> <span class="va">age_focal</span>,</span>
<span>         stage_kin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">stage_kin</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span>,</span>
<span>                       labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>                         <span class="st">"no education"</span>,</span>
<span>                         <span class="st">"incomplete primary"</span>,</span>
<span>                         <span class="st">"primary"</span>,</span>
<span>                         <span class="st">"lower secondary"</span>,</span>
<span>                         <span class="st">"upper secondary"</span>,</span>
<span>                         <span class="st">"post-secondary"</span></span>
<span>                       <span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="education-kin-analysis">Analyzing Kin by Educational Attainment<a class="anchor" aria-label="anchor" href="#education-kin-analysis"></a>
</h3>
<div class="section level4">
<h4 id="education-cohort-analysis">Cohort Analysis of Kin by Education<a class="anchor" aria-label="anchor" href="#education-cohort-analysis"></a>
</h4>
<p>First, let’s visualize the total number of living kin by educational
attainment for a woman born in 2020 in Singapore:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kin_out_2020_2090</span><span class="op">$</span><span class="va">kin_summary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Exclude Focal from the analysis</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">group</span> <span class="op">!=</span> <span class="st">"Focal"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cohort</span> <span class="op">==</span> <span class="fl">2020</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>kin <span class="op">=</span> <span class="va">group</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># rename_kin(sex = "2sex") %&gt;% </span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span>, .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">stage_kin</span>, <span class="va">age_focal</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age_focal</span>, y <span class="op">=</span> <span class="va">count</span>, fill <span class="op">=</span> <span class="va">stage_kin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_area</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Total living kin by educational attainment over the life course"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"For a woman born in 2020, Singapore"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Expected number of living kin"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Age of focal individual"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Educational attainment"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p><img src="2_2_TwoSex_TimeVarying_AgeStage_files/figure-html/education_total_kin-1.png" width="2400" style="display: block; margin: auto;"></p>
<p>Now let’s look at specific types of relatives:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kin_out_2020_2090</span><span class="op">$</span><span class="va">kin_summary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"d"</span>, <span class="st">"gd"</span>, <span class="st">"m"</span>, <span class="st">"gm"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cohort</span> <span class="op">==</span> <span class="fl">2020</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>kin <span class="op">=</span> <span class="va">group</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># rename_kin(sex = "2sex") %&gt;% </span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span>, .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">kin</span>, <span class="va">stage_kin</span>, <span class="va">age_focal</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age_focal</span>, y <span class="op">=</span> <span class="va">count</span>, fill <span class="op">=</span> <span class="va">stage_kin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_area</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Living kin by educational attainment over the life course"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"For a woman born in 2020, Singapore"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Expected number of living kin"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Age of focal individual"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Educational attainment"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">kin</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p><img src="2_2_TwoSex_TimeVarying_AgeStage_files/figure-html/education_specific_kin-1.png" width="2400" style="display: block; margin: auto;"></p>
<p><strong>Interpretation</strong> This visualization captures how
educational expansion transforms family networks, showing the increasing
educational diversity across generations in Singapore:</p>
<ul>
<li>The total number of living relatives peaks around age 40-50</li>
<li>Relatives with upper secondary education (blue) constitute the
largest proportion of the kinship network</li>
<li>The educational composition of relatives changes dynamically across
the life course</li>
<li>At younger ages, relatives have lower educational attainment. As
Focal ages, the proportion of higher-educated relatives (green, yellow,
and red categories) increases</li>
</ul>
<p>Let’s examine the age and educational distribution of key relatives
when the focal individual is 60 years old:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kin_out_2020_2090</span><span class="op">$</span><span class="va">kin_full</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"d"</span>, <span class="st">"gd"</span>, <span class="st">"m"</span>, <span class="st">"gm"</span><span class="op">)</span>,</span>
<span>    <span class="va">age_focal</span> <span class="op">==</span> <span class="fl">60</span>,</span>
<span>    <span class="va">cohort</span> <span class="op">==</span> <span class="fl">2020</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>kin <span class="op">=</span> <span class="va">group</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># rename_kin("2sex") %&gt;% </span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age_kin</span>, y <span class="op">=</span> <span class="va">count</span>, color <span class="op">=</span> <span class="va">stage_kin</span>, fill <span class="op">=</span> <span class="va">stage_kin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"stack"</span>, stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">30</span>,<span class="fl">40</span>,<span class="fl">50</span>,<span class="fl">60</span>,<span class="fl">70</span>,<span class="fl">80</span>,<span class="fl">90</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Age and educational distribution of key relatives"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"For a 60-year-old woman born in 2020, Singapore"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Age of relative"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Number of relatives"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Educational attainment"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Educational attainment"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">kin</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"bottom"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="2_2_TwoSex_TimeVarying_AgeStage_files/figure-html/education_age_distribution-1.png" width="3000" style="display: block; margin: auto;"></p>
<p><strong>Interpretation</strong>: This visualization reveals the
evolving educational composition of different types of relatives across
the life course for a woman born in 2020 in Singapore:</p>
<ul>
<li>
<strong>Children</strong> (d): Educational attainment increases with
Focal’s age, showing a shift towards higher education levels</li>
<li>
<strong>Grandchildren</strong> (gd): Emerge later in life with a
more diverse educational profile</li>
<li>
<strong>Grandparents</strong> (gm): Predominantly have upper
secondary (blue) and lower secondary (teal) education</li>
<li>
<strong>Parents</strong> (m): Similar to grandparents, with a
concentration of upper secondary education</li>
</ul>
</div>
<div class="section level4">
<h4 id="education-period-analysis">Period Analysis of Kin by Education<a class="anchor" aria-label="anchor" href="#education-period-analysis"></a>
</h4>
<p>Now let’s examine how the educational composition of specific
relatives changes over time. First, let’s look at the educational
attainment of descendants (children and grandchildren) of 60-year-old
women across different calendar years:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kin_out_2020_2090</span><span class="op">$</span><span class="va">kin_summary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"d"</span>, <span class="st">"gd"</span><span class="op">)</span>,</span>
<span>    <span class="va">age_focal</span> <span class="op">==</span> <span class="fl">60</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>kin <span class="op">=</span> <span class="va">group</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># rename_kin(sex = "2sex") %&gt;% </span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span>, .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">stage_kin</span>, <span class="va">kin</span>, <span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">count</span>, fill <span class="op">=</span> <span class="va">stage_kin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_area</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Educational attainment of descendants over time"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"For women aged 60, Singapore, 2020-2090"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Expected number of descendants"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Educational attainment"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">kin</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p><img src="2_2_TwoSex_TimeVarying_AgeStage_files/figure-html/education_descendants_time-1.png" width="2400" style="display: block; margin: auto;"></p>
<p><strong>Interpretation</strong>:</p>
<ul>
<li>
<strong>Children</strong> (d): Concentrated between ages 30-50, with
upper secondary education (blue) being most prevalent</li>
<li>
<strong>Grandchildren</strong> (gd): Mostly young (under 20), with
emerging educational diversity</li>
<li>
<strong>Grandparents</strong> (gm): No longer living at this
point</li>
<li>
<strong>Parents</strong> (m): Clustered around ages 80-90, with
upper secondary and lower secondary education dominating</li>
</ul>
</div>
</div>
</div>
<div class="section level2">
<h2 id="limitations">Limitations and Assumptions<a class="anchor" aria-label="anchor" href="#limitations"></a>
</h2>
<p>When implementing these models, we’ve made several simplifying
assumptions due to data limitations:</p>
<p>For the UK parity model:</p>
<ol style="list-style-type: decimal">
<li>Fertility rates vary with time and parity but are the same across
sexes</li>
<li>Mortality rates vary with time and sex but are the same across
parity classes</li>
<li>Parity progression probabilities vary with time but are the same
across sexes</li>
</ol>
<p>For the Singapore education model:</p>
<ol style="list-style-type: decimal">
<li>Fertility rates vary over time and by education but are identical
for both sexes</li>
<li>Age-specific education transition probabilities vary over time but
not by sex</li>
<li>Educational transitions for young children follow Singapore’s
Compulsory Education Act</li>
<li>Demographic rates before 2020 are assumed stable
(time-invariant)</li>
</ol>
<p>These assumptions should be kept in mind when interpreting the
results.</p>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>In this vignette, we’ve implemented two-sex time-varying multi-state
kinship models—the most comprehensive demographic kinship framework
currently available. By integrating age, sex, time, and stage
dimensions, these models provide unprecedented insights into family
structures and their evolution.</p>
<p>Our two examples demonstrated the analytical power of this integrated
approach:</p>
<ul>
<li>The parity example revealed how reproductive patterns shape family
structures differently for males and females across historical
periods</li>
<li>The education example showed how educational expansion transforms
kinship networks, creating increasingly educated family systems over
time</li>
</ul>
<p>These comprehensive models have numerous applications across
disciplines:</p>
<ul>
<li>Understanding intergenerational transmission of socioeconomic
status</li>
<li>Analyzing care needs and support networks in diverse
populations</li>
<li>Projecting how family structures might evolve under different
demographic scenarios</li>
<li>Exploring how education, health, marriage, and other characteristics
intersect with kinship</li>
</ul>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Butterick2025" class="csl-entry">
Butterick, Joe W. B., Peter W. F. Smith, Jakub Bijak, and Jason Hilton.
2025. <span>“A Mathematical Framework for Time-Variant Multi-State
Kinship Modelling.”</span> <em>Theoretical Population Biology</em> 163:
1–12. https://doi.org/<a href="https://doi.org/10.1016/j.tpb.2025.02.002" class="external-link">https://doi.org/10.1016/j.tpb.2025.02.002</a>.
</div>
<div id="ref-caswell_formal_2019" class="csl-entry">
Caswell, Hal. 2019. <span>“The Formal Demography of Kinship:
<span>A</span> Matrix Formulation.”</span> <em>Demographic Research</em>
41 (September): 679–712. <a href="https://doi.org/10.4054/DemRes.2019.41.24" class="external-link">https://doi.org/10.4054/DemRes.2019.41.24</a>.
</div>
<div id="ref-caswell_formal_2020" class="csl-entry">
———. 2020. <span>“The Formal Demography of Kinship <span>II</span>:
<span>Multistate</span> Models, Parity, and Sibship.”</span>
<em>Demographic Research</em> 42 (June): 1097–1146. <a href="https://doi.org/10.4054/DemRes.2020.42.38" class="external-link">https://doi.org/10.4054/DemRes.2020.42.38</a>.
</div>
<div id="ref-caswell_formal_2022" class="csl-entry">
———. 2022. <span>“The Formal Demography of Kinship <span>IV</span>:
<span>Two</span>-Sex Models and Their Approximations.”</span>
<em>Demographic Research</em> 47 (September): 359–96. <a href="https://doi.org/10.4054/DemRes.2022.47.13" class="external-link">https://doi.org/10.4054/DemRes.2022.47.13</a>.
</div>
<div id="ref-caswell_formal_2021" class="csl-entry">
Caswell, Hal, and Xi Song. 2021. <span>“The Formal Demography of Kinship
<span>III</span>: <span>Kinship</span> Dynamics with Time-Varying
Demographic Rates.”</span> <em>Demographic Research</em> 45 (August):
517–46. <a href="https://doi.org/10.4054/DemRes.2021.45.16" class="external-link">https://doi.org/10.4054/DemRes.2021.45.16</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Iván Williams, Diego Alburez-Gutierrez.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

      </footer>
</div>






  </body>
</html>
