<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Expected kin counts by type of relative in a one-sex framework • DemoKin</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Expected kin counts by type of relative in a one-sex framework">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">DemoKin</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Reference_OneSex.html">Expected kin counts by type of relative in a one-sex framework</a></li>
    <li><a class="dropdown-item" href="../articles/Reference_TwoSex_MultiState_TimeVariant.html">Expected kin counts by type of relative in a two-sex multi-state time-varying framework</a></li>
    <li><a class="dropdown-item" href="../articles/Reference_TwoSex.html">Two-sex kinship model</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/IvanWilli/DemoKin/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Expected kin counts by type of relative in a one-sex framework</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/IvanWilli/DemoKin/blob/main/vignettes/Reference_OneSex.Rmd" class="external-link"><code>vignettes/Reference_OneSex.Rmd</code></a></small>
      <div class="d-none name"><code>Reference_OneSex.Rmd</code></div>
    </div>

    
    
<p>In this vignette, we’ll demonstrate how <code>DemoKin</code> can be
used to compute kinship networks for an average member of a given
(female) population. Let us call her Focal: an average Swedish woman who
has always lived in Sweden and whose family has never left the country.
Here, we’ll show how <code>DemoKin</code> can be used to compute the
number and age distribution of Focal’s relatives under a range of
assumptions, including living and deceased kin.</p>
<div class="section level2">
<h2 id="kin-counts-with-time-invariant-rates">1. Kin counts with time-invariant rates<a class="anchor" aria-label="anchor" href="#kin-counts-with-time-invariant-rates"></a>
</h2>
<p>First, we compute kin counts in a <strong>time-invariant</strong>
framework. We assume that Focal and all of her relatives experience the
2015 mortality and fertility rates throughout their entire lives <span class="citation">(Caswell 2019)</span>. The <code>DemoKin</code> package
includes data from Sweden as an example: age-by-year matrices of
survival probabilities (<em>swe_px</em>), survival ratios
(<em>swe_Sx</em>), fertility rates (<em>swe_asfr</em>), and population
numbers (<em>swe_pop</em>). You can see the data contained in
<code>DemoKin</code> with <code>data(package="DemoKin")</code>. This
data comes from the <a href="https://www.mortality.org/" class="external-link">Human Mortality
Database</a> and <a href="https://www.humanfertility.org/" class="external-link">Human
Fertility Database</a> (see <code>?DemoKin::get_HMDHFD</code>).</p>
<p>In order to implement the time-invariant models, the function
<code><a href="../reference/kin.html">DemoKin::kin</a></code> expects a vector of survival ratios and
another vector of fertility rates. In this example, we get the data for
the year 2015, and run the matrix models:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pkgload</span><span class="fu">::</span><span class="fu"><a href="https://pkgload.r-lib.org/reference/load_all.html" class="external-link">load_all</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span><span class="co"># First, get vectors for a given year</span></span>
<span><span class="va">swe_surv_2015</span> <span class="op">&lt;-</span> <span class="va">swe_px</span><span class="op">[</span>,<span class="st">"2015"</span><span class="op">]</span></span>
<span><span class="va">swe_asfr_2015</span> <span class="op">&lt;-</span> <span class="va">swe_asfr</span><span class="op">[</span>,<span class="st">"2015"</span><span class="op">]</span></span>
<span><span class="co"># Run kinship models</span></span>
<span><span class="va">swe_2015</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/kin.html">kin</a></span><span class="op">(</span>p <span class="op">=</span> <span class="va">swe_surv_2015</span>, f <span class="op">=</span> <span class="va">swe_asfr_2015</span>, time_invariant <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="value">1.1. Value<a class="anchor" aria-label="anchor" href="#value"></a>
</h3>
<p><code><a href="../reference/kin.html">DemoKin::kin()</a></code> returns a list containing two data
frames: <code>kin_full</code> and <code>kin_summary</code>.</p>
<p><code>kin_full</code> contains expected kin counts by year (or
cohort), age of Focal and age of kin. Note that the columns
<code>year</code> and <code>cohort</code> are empty if the argument is
<code>time_invariant = TRUE</code> in <code>kin</code> (as in this
example).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">swe_2015</span><span class="op">$</span><span class="va">kin_full</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">##   kin   age_kin age_focal living  dead cohort year </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> d           0         0      0     0 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> d           0         1      0     0 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> d           0         2      0     0 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> d           0         3      0     0 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> d           0         4      0     0 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> d           0         5      0     0 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></span></code></pre>
<p><code>kin_summary</code> is a ‘summary’ data frame derived from
<code>kin_full</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">swe_2015</span><span class="op">$</span><span class="va">kin_summary</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 10</span></span></span>
<span><span class="co">##   age_focal kin   year  cohort count_living mean_age sd_age count_dead</span></span>
<span><span class="co">##       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>         0 coa   <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>           0.275      8.32   6.14  0.000<span style="text-decoration: underline;">063</span>3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>         0 cya   <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>           0.089<span style="text-decoration: underline;">8</span>     4.05   3.68  0.000<span style="text-decoration: underline;">037</span>0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>         0 d     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>           0        <span style="color: #BB0000;">NaN</span>    <span style="color: #BB0000;">NaN</span>     0        </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>         0 gd    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>           0        <span style="color: #BB0000;">NaN</span>    <span style="color: #BB0000;">NaN</span>     0        </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>         0 ggd   <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>           0        <span style="color: #BB0000;">NaN</span>    <span style="color: #BB0000;">NaN</span>     0        </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>         0 ggm   <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>           0.320     84.4    6.43  0.028<span style="text-decoration: underline;">7</span>   </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 2 more variables: count_cum_dead &lt;dbl&gt;, mean_age_lost &lt;dbl&gt;</span></span></span></code></pre>
<p>To produce it, we sum over all ages of kin to produce a data frame of
expected kin counts by year or cohort and age of Focal (but not by age
of kin). Consider this simplified example for living kin counts:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kin_summary_example</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">swe_2015</span><span class="op">$</span><span class="va">kin_full</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">cohort</span>, <span class="va">kin</span>, <span class="va">age_focal</span>, <span class="va">age_kin</span>, <span class="va">living</span>, <span class="va">dead</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">cohort</span>, <span class="va">kin</span>, <span class="va">age_focal</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>count_living <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">living</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">kin_summary_example</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 5</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   year, cohort, kin [1]</span></span></span>
<span><span class="co">##   year  cohort kin   age_focal count_living</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     coa           0        0.275</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     coa           1        0.291</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     coa           2        0.305</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     coa           3        0.318</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     coa           4        0.330</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     coa           5        0.341</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="visualizing-the-distribution-of-kin">1.2. Visualizing the distribution of kin<a class="anchor" aria-label="anchor" href="#visualizing-the-distribution-of-kin"></a>
</h3>
<p>Let us now visualize the distribution of relatives over Focal’s
lifecourse using the summary data.frame <code>kin_summary</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">swe_2015</span><span class="op">[[</span><span class="st">"kin_summary"</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">age_focal</span>, <span class="va">count_living</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Expected number of living relatives"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">kin</span><span class="op">)</span></span></code></pre></div>
<p><img src="Reference_OneSex_files/figure-html/unnamed-chunk-6-1.png" width="768"></p>
<p>Here, each relative type is identified by a unique code. Note that
<code>DemoKin</code> uses different codes than Caswell <span class="citation">(2019)</span>; the equivalence between the two set of
codes is given in the following table:</p>
<table class="table">
<colgroup>
<col width="7%">
<col width="7%">
<col width="25%">
<col width="27%">
<col width="31%">
</colgroup>
<thead><tr class="header">
<th align="left">DemoKin</th>
<th align="left">Caswell</th>
<th align="left">Labels_female</th>
<th align="left">Labels_male</th>
<th align="left">Labels_2sex</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">coa</td>
<td align="left">t</td>
<td align="left">Cousins from older aunts</td>
<td align="left">Cousins from older uncles</td>
<td align="left">Cousins from older aunts/uncles</td>
</tr>
<tr class="even">
<td align="left">cya</td>
<td align="left">v</td>
<td align="left">Cousins from younger aunts</td>
<td align="left">Cousins from younger uncles</td>
<td align="left">Cousins from younger aunts/uncles</td>
</tr>
<tr class="odd">
<td align="left">c</td>
<td align="left">NA</td>
<td align="left">Cousins</td>
<td align="left">Cousins</td>
<td align="left">Cousins</td>
</tr>
<tr class="even">
<td align="left">d</td>
<td align="left">a</td>
<td align="left">Daughters</td>
<td align="left">Sons</td>
<td align="left">Children</td>
</tr>
<tr class="odd">
<td align="left">gd</td>
<td align="left">b</td>
<td align="left">Grand-daughters</td>
<td align="left">Grand-sons</td>
<td align="left">Grand-childrens</td>
</tr>
<tr class="even">
<td align="left">ggd</td>
<td align="left">c</td>
<td align="left">Great-grand-daughters</td>
<td align="left">Great-grand-sons</td>
<td align="left">Great-grand-childrens</td>
</tr>
<tr class="odd">
<td align="left">ggm</td>
<td align="left">h</td>
<td align="left">Great-grandmothers</td>
<td align="left">Great-grandfathers</td>
<td align="left">Great-grandfparents</td>
</tr>
<tr class="even">
<td align="left">gm</td>
<td align="left">g</td>
<td align="left">Grandmothers</td>
<td align="left">Grandfathers</td>
<td align="left">Grandparents</td>
</tr>
<tr class="odd">
<td align="left">m</td>
<td align="left">d</td>
<td align="left">Mother</td>
<td align="left">Father</td>
<td align="left">Parents</td>
</tr>
<tr class="even">
<td align="left">nos</td>
<td align="left">p</td>
<td align="left">Nieces from older sisters</td>
<td align="left">Nephews from older brothers</td>
<td align="left">Niblings from older siblings</td>
</tr>
<tr class="odd">
<td align="left">nys</td>
<td align="left">q</td>
<td align="left">Nieces from younger sisters</td>
<td align="left">Nephews from younger brothers</td>
<td align="left">Niblings from younger siblings</td>
</tr>
<tr class="even">
<td align="left">n</td>
<td align="left">NA</td>
<td align="left">Nieces</td>
<td align="left">Nephews</td>
<td align="left">Niblings</td>
</tr>
<tr class="odd">
<td align="left">oa</td>
<td align="left">r</td>
<td align="left">Aunts older than mother</td>
<td align="left">Uncles older than fathers</td>
<td align="left">Aunts/Uncles older than parents</td>
</tr>
<tr class="even">
<td align="left">ya</td>
<td align="left">s</td>
<td align="left">Aunts younger than mother</td>
<td align="left">Uncles younger than father</td>
<td align="left">Aunts/Uncles younger than parents</td>
</tr>
<tr class="odd">
<td align="left">a</td>
<td align="left">NA</td>
<td align="left">Aunts</td>
<td align="left">Uncles</td>
<td align="left">Aunts/Uncles</td>
</tr>
<tr class="even">
<td align="left">os</td>
<td align="left">m</td>
<td align="left">Older sisters</td>
<td align="left">Older brothers</td>
<td align="left">Older siblings</td>
</tr>
<tr class="odd">
<td align="left">ys</td>
<td align="left">n</td>
<td align="left">Younger sisters</td>
<td align="left">Younger brothers</td>
<td align="left">Younger siblings</td>
</tr>
<tr class="even">
<td align="left">s</td>
<td align="left">NA</td>
<td align="left">Sisters</td>
<td align="left">Brothers</td>
<td align="left">Siblings</td>
</tr>
</tbody>
</table>
<p>We can also visualize the age distribution of relatives when Focal is
35 years old (now, with full names to identify each relative type using
the function <code><a href="../reference/rename_kin.html">DemoKin::rename_kin()</a></code>):</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">swe_2015</span><span class="op">[[</span><span class="st">"kin_full"</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">age_focal</span> <span class="op">==</span> <span class="fl">35</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">age_kin</span>, <span class="va">living</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">35</span>, color<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Expected number of living relatives"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">kin</span><span class="op">)</span></span></code></pre></div>
<p><img src="Reference_OneSex_files/figure-html/unnamed-chunk-8-1.png" width="768"></p>
<p>The one-sex model implemented in <code>DemoKin</code> assumes that
the given fertility input applies to both sexes. Note that, if using
survival rates
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>S</mi><mi>x</mi></msub><annotation encoding="application/x-tex">S_x</annotation></semantics></math>)
instead of probabilities
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mi>x</mi></msub><annotation encoding="application/x-tex">p_x</annotation></semantics></math>),
fertility vectors should account for female person-year exposure, using:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mrow><msub><mi>f</mi><mi>x</mi></msub><mo>+</mo><msub><mi>f</mi><mrow><mi>x</mi><mo>+</mo><mn>1</mn></mrow></msub><msub><mi>S</mi><mi>x</mi></msub></mrow><mn>2</mn></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mfrac><msub><mi>L</mi><mn>0</mn></msub><msub><mi>l</mi><mn>0</mn></msub></mfrac></mrow><annotation encoding="application/x-tex">(\frac{f_x+f_{x+1}S_x}{2})\frac{L_0}{l_0}</annotation></semantics></math>
instead of only
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">fx</annotation></semantics></math>;
see Preston et.al <span class="citation">(2001)</span>).</p>
<p>The <code>kin</code> function also includes a summary output with the
count of living kin, mean and standard deviation of kin age, by type of
kin, for each Focal’s age:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">swe_2015</span><span class="op">[[</span><span class="st">"kin_summary"</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">age_focal</span> <span class="op">==</span> <span class="fl">35</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">kin</span>, <span class="va">count_living</span>, <span class="va">mean_age</span>, <span class="va">sd_age</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_if</a></span><span class="op">(</span><span class="va">is.numeric</span>, <span class="va">round</span>, <span class="fl">2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">kin</th>
<th align="right">count_living</th>
<th align="right">mean_age</th>
<th align="right">sd_age</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">coa</td>
<td align="right">0.38</td>
<td align="right">39.23</td>
<td align="right">8.41</td>
</tr>
<tr class="even">
<td align="left">cya</td>
<td align="right">0.42</td>
<td align="right">27.59</td>
<td align="right">8.47</td>
</tr>
<tr class="odd">
<td align="left">d</td>
<td align="right">0.70</td>
<td align="right">5.52</td>
<td align="right">3.80</td>
</tr>
<tr class="even">
<td align="left">gd</td>
<td align="right">0.00</td>
<td align="right">0.42</td>
<td align="right">0.71</td>
</tr>
<tr class="odd">
<td align="left">ggd</td>
<td align="right">0.00</td>
<td align="right">NaN</td>
<td align="right">NaN</td>
</tr>
<tr class="even">
<td align="left">ggm</td>
<td align="right">0.00</td>
<td align="right">96.90</td>
<td align="right">2.60</td>
</tr>
<tr class="odd">
<td align="left">gm</td>
<td align="right">0.18</td>
<td align="right">88.62</td>
<td align="right">5.02</td>
</tr>
<tr class="even">
<td align="left">m</td>
<td align="right">0.93</td>
<td align="right">65.36</td>
<td align="right">5.10</td>
</tr>
<tr class="odd">
<td align="left">nos</td>
<td align="right">0.36</td>
<td align="right">9.72</td>
<td align="right">5.93</td>
</tr>
<tr class="even">
<td align="left">nys</td>
<td align="right">0.16</td>
<td align="right">3.80</td>
<td align="right">3.19</td>
</tr>
<tr class="odd">
<td align="left">oa</td>
<td align="right">0.37</td>
<td align="right">70.04</td>
<td align="right">6.32</td>
</tr>
<tr class="even">
<td align="left">os</td>
<td align="right">0.43</td>
<td align="right">40.18</td>
<td align="right">4.25</td>
</tr>
<tr class="odd">
<td align="left">ya</td>
<td align="right">0.45</td>
<td align="right">58.87</td>
<td align="right">6.75</td>
</tr>
<tr class="even">
<td align="left">ys</td>
<td align="right">0.47</td>
<td align="right">28.49</td>
<td align="right">4.42</td>
</tr>
</tbody>
</table>
<p>Finally, we can visualize the estimated kin counts by type of kin
using a network diagram. Following with the age 35:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">swe_2015</span><span class="op">[[</span><span class="st">"kin_summary"</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">age_focal</span> <span class="op">==</span> <span class="fl">35</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">kin</span>, count <span class="op">=</span> <span class="va">count_living</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/plot_diagram.html">plot_diagram</a></span><span class="op">(</span>rounding <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="Reference_OneSex_files/figure-html/unnamed-chunk-10-1.png" width="7200"></p>
</div>
</div>
<div class="section level2">
<h2 id="kin-counts-with-time-variant-rates">2. Kin counts with time-variant rates<a class="anchor" aria-label="anchor" href="#kin-counts-with-time-variant-rates"></a>
</h2>
<p>The demography of Sweden is, in reality, changing every year. This
means that Focal and her relatives will have experienced changing
mortality and fertility rates over time. We account for this, by using
the time-variant models introduced by Caswell and Song <span class="citation">(2021)</span>. Let’s take a look at the resulting kin
counts for a Focal born in 1960, limiting the output to the relative
types given in the argument <code>output_kin</code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">swe_time_varying</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/kin.html">kin</a></span><span class="op">(</span></span>
<span>    p <span class="op">=</span> <span class="va">swe_px</span>,</span>
<span>    f <span class="op">=</span> <span class="va">swe_asfr</span>,</span>
<span>    n <span class="op">=</span> <span class="va">swe_pop</span>,</span>
<span>    time_invariant <span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>    output_cohort <span class="op">=</span> <span class="fl">1960</span>,</span>
<span>    output_kin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"d"</span>,<span class="st">"gd"</span>,<span class="st">"ggd"</span>,<span class="st">"m"</span>,<span class="st">"gm"</span>,<span class="st">"ggm"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Preparing output...</span></span></code></pre>
<pre><code><span><span class="co">## Assuming stable population before 1900.</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">swe_time_varying</span><span class="op">$</span><span class="va">kin_summary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">age_focal</span>,<span class="va">count_living</span>,color<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">cohort</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">""</span>,labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span>,<span class="fl">.2</span><span class="op">)</span>,breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span>,<span class="fl">.2</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">35</span>, color<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Expected number of living relatives"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">kin</span>,scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Reference_OneSex_files/figure-html/unnamed-chunk-11-1.png" width="768"></p>
<!-- As you see the estimates stop at age 55, because no data is after 2015. -->
</div>
<div class="section level2">
<h2 id="kin-deaths">3. Kin deaths<a class="anchor" aria-label="anchor" href="#kin-deaths"></a>
</h2>
<p>Kin loss can have severe consequences for bereaved relatives. It can
also affect the provision of care support and intergenerational
transfers over the life course. The function <code>kin</code> also
includes information on the number of relatives lost by Focal during her
life, stored in the column <code>count_cum_death</code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">swe_time_varying</span><span class="op">$</span><span class="va">kin_summary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">age_focal</span>, <span class="va">count_cum_dead</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Expected number of deceased relatives"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">kin</span>,scales<span class="op">=</span><span class="st">"free"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Reference_OneSex_files/figure-html/unnamed-chunk-12-1.png" width="768"></p>
<p>Given these population-level measures, we can compute Focal’s the
mean age at the time of her relative’s death. For a Focal aged 50
yo:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">swe_time_varying</span><span class="op">$</span><span class="va">kin_summary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">age_focal</span> <span class="op">==</span> <span class="fl">50</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">kin</span>,<span class="va">count_cum_dead</span>,<span class="va">mean_age_lost</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_if</a></span><span class="op">(</span><span class="va">is.numeric</span>, <span class="va">round</span>, <span class="fl">2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">kin</th>
<th align="right">count_cum_dead</th>
<th align="right">mean_age_lost</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">d</td>
<td align="right">0.01</td>
<td align="right">32.59</td>
</tr>
<tr class="even">
<td align="left">gd</td>
<td align="right">0.00</td>
<td align="right">47.13</td>
</tr>
<tr class="odd">
<td align="left">ggd</td>
<td align="right">0.00</td>
<td align="right">49.66</td>
</tr>
<tr class="even">
<td align="left">ggm</td>
<td align="right">0.22</td>
<td align="right">8.94</td>
</tr>
<tr class="odd">
<td align="left">gm</td>
<td align="right">0.84</td>
<td align="right">24.96</td>
</tr>
<tr class="even">
<td align="left">m</td>
<td align="right">0.32</td>
<td align="right">37.83</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="prevalences">4. Prevalences<a class="anchor" aria-label="anchor" href="#prevalences"></a>
</h2>
<p>Given the distribution of kin by age, we can compute the expected
portion of living kin in some stage given a set of prevalences by age
(e.g., a disease, employment, etc.). This is known as the Sullivan
Method in the life-table literature. A matrix formulation for same
results can be found in Caswell <span class="citation">(2019)</span>,
which can also be extended to a time-variant framework.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># let´s create some prevalence by age</span></span>
<span><span class="va">swe_2015_prevalence</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    age_kin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">swe_2015</span><span class="op">$</span><span class="va">kin_full</span><span class="op">$</span><span class="va">age_kin</span><span class="op">)</span>,</span>
<span>    prev <span class="op">=</span> <span class="fl">.005</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fl">.05</span> <span class="op">*</span> <span class="va">age_kin</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="co"># join to kin count estimates and plot</span></span>
<span><span class="va">swe_2015</span><span class="op">$</span><span class="va">kin_full</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">swe_2015_prevalence</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">kin</span>, <span class="va">age_focal</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    prevalent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">living</span> <span class="op">*</span> <span class="va">prev</span><span class="op">)</span>,</span>
<span>    no_prevalent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">living</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">prev</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="va">prevalent</span><span class="op">:</span><span class="va">no_prevalent</span>, names_to <span class="op">=</span> <span class="st">"prevalence_state"</span>, values_to <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">age_focal</span>, y <span class="op">=</span> <span class="va">count</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_area</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">prevalence_state</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">kin</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Reference_OneSex_files/figure-html/unnamed-chunk-14-1.png" width="960"></p>
</div>
<div class="section level2">
<h2 id="multi-state-models">5. Multi-state models<a class="anchor" aria-label="anchor" href="#multi-state-models"></a>
</h2>
<p><code>DemoKin</code> allows the computation of kin structures in a
multi-state framework, classifying individuals jointly by age and some
other feature (e.g., stages of a disease). For this, we need mortality
and fertility data for each possible stage and probabilities of changing
state by age.</p>
<p>Let’s consider the example of Slovakia given by Caswell <span class="citation">(2021)</span>, where stages are parity states.
<code>DemoKin</code> includes the data to replicate this analysis for
the year 1980:</p>
<ul>
<li>The data.frame <code>svk_fxs</code> is the fertility rate by age
(rows) for each parity stage (columns). The first stage represents
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>a</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>y</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">parity=0</annotation></semantics></math>;
the second stage,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>a</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>y</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">parity=1</annotation></semantics></math>;
and so on, until finally the sixth stage represents
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>a</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>y</mi><mo>≥</mo><mn>5</mn></mrow><annotation encoding="application/x-tex">parity\geq5</annotation></semantics></math>.</li>
<li>The data.frame <code>svk_Hxs</code> has a similar structure but with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math>’s
in the ages corresponding to newborns (the first age in our
example).</li>
<li>The data.frame <code>svk_pxs</code> has the same structure and
represents survival probabilities.</li>
<li>The list <code>svk_Uxs</code> has the same number of elements and
ages (in this case 110, where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><mi>a</mi></mrow><annotation encoding="application/x-tex">omega</annotation></semantics></math>
is 109). For each age, it contains a column-stochastic transition matrix
with dimension for the state space. The entries are transition
probabilities conditional on survival.</li>
</ul>
<p>Following Caswell <span class="citation">(2020)</span>, we can obtain
the joint age-parity kin structure:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># use birth_female=1 because fertility is for female only</span></span>
<span><span class="va">demokin_svk1980_caswell2020</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/kin_multi_stage.html">kin_multi_stage</a></span><span class="op">(</span></span>
<span>    U <span class="op">=</span> <span class="va">svk_Uxs</span>,</span>
<span>    f <span class="op">=</span> <span class="va">svk_fxs</span>,</span>
<span>    D <span class="op">=</span> <span class="va">svk_pxs</span>,</span>
<span>    H <span class="op">=</span> <span class="va">svk_Hxs</span>, </span>
<span>    birth_female<span class="op">=</span><span class="fl">1</span>,</span>
<span>    parity <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Note that the function ask for risks already in a certain matrix
format. As an example, consider the age-parity distribution of aunts,
when Focal is 20 and 60 yo (this is equivalent to Figure 4 in Caswell
<span class="citation">(2021)</span>).</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">demokin_svk1980_caswell2020</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">kin</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"oa"</span>,<span class="st">"ya"</span><span class="op">)</span>, <span class="va">age_focal</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">60</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>parity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">stage_kin</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span>,</span>
<span>         parity <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">parity</span> <span class="op">==</span> <span class="fl">5</span> <span class="op">~</span> <span class="st">"5+"</span>, <span class="cn">T</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">parity</span><span class="op">)</span><span class="op">)</span></span>
<span>         <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">age_focal</span>, <span class="va">age_kin</span>, <span class="va">parity</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>count<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">living</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">age_kin</span>, y <span class="op">=</span> <span class="va">count</span>, fill<span class="op">=</span><span class="va">parity</span><span class="op">)</span>, stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">age_focal</span><span class="op">)</span>, col<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Number of aunts"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">age_focal</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="Reference_OneSex_files/figure-html/unnamed-chunk-16-1.png" width="960"></p>
<p>We can also see the portion of living daughters and mothers at
different parity stages over Focal’s life-course (this is equivalent to
Figure 9 and 10 in Caswell <span class="citation">(2021)</span>).</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">demokin_svk1980_caswell2020</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">kin</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"d"</span>,<span class="st">"m"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>parity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">stage_kin</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span>,</span>
<span>         parity <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">parity</span> <span class="op">==</span> <span class="fl">5</span> <span class="op">~</span> <span class="st">"5+"</span>, <span class="cn">T</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">parity</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">age_focal</span>, <span class="va">kin</span>, <span class="va">parity</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>count<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">living</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">DemoKin</span><span class="fu">::</span><span class="fu"><a href="../reference/rename_kin.html">rename_kin</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">age_focal</span>, y <span class="op">=</span> <span class="va">count</span>, fill<span class="op">=</span><span class="va">parity</span><span class="op">)</span>, stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Kin count"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">kin</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="Reference_OneSex_files/figure-html/unnamed-chunk-17-1.png" width="960"></p>
<p>This function <code>kin_multi_stage</code> can be generalized to any
kind of state (be sure to set parameter <code>parity = FALSE</code>, de
default).</p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-caswell_formal_2019" class="csl-entry">
Caswell, Hal. 2019. <span>“The Formal Demography of Kinship:
<span>A</span> Matrix Formulation.”</span> <em>Demographic Research</em>
41 (September): 679–712. <a href="https://doi.org/10.4054/DemRes.2019.41.24" class="external-link">https://doi.org/10.4054/DemRes.2019.41.24</a>.
</div>
<div id="ref-caswell_formal_2020" class="csl-entry">
———. 2020. <span>“The Formal Demography of Kinship <span>II</span>:
<span>Multistate</span> Models, Parity, and Sibship.”</span>
<em>Demographic Research</em> 42 (June): 1097–1146. <a href="https://doi.org/10.4054/DemRes.2020.42.38" class="external-link">https://doi.org/10.4054/DemRes.2020.42.38</a>.
</div>
<div id="ref-caswell_formal_2021" class="csl-entry">
Caswell, Hal, and Xi Song. 2021. <span>“The Formal Demography of Kinship
<span>III</span>: <span>Kinship</span> Dynamics with Time-Varying
Demographic Rates.”</span> <em>Demographic Research</em> 45 (August):
517–46. <a href="https://doi.org/10.4054/DemRes.2021.45.16" class="external-link">https://doi.org/10.4054/DemRes.2021.45.16</a>.
</div>
<div id="ref-preston_demography:_2001" class="csl-entry">
Preston, Samuel H., Patrick Heuveline, and Michel Guillot. 2001.
<em>Demography: Measuring and Modeling Population Processes</em>.
Malden, MA: Blackwell Publishers.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Iván Williams, Diego Alburez-Gutierrez.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
