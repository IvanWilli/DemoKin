<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Two-sex time-varying kinship model specified by age • DemoKin</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Two-sex time-varying kinship model specified by age">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">DemoKin</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fas fa-home fa-lg"></span></a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-models-by-age" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Models by Age</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-models-by-age">
<li><a class="dropdown-item" href="../articles/1_1_OneSex_TimeInvariant_Age.html">One-sex time-invariant model</a></li>
    <li><a class="dropdown-item" href="../articles/1_2_OneSex_TimeVarying_Age.html">One-sex time-varying model</a></li>
    <li><a class="dropdown-item" href="../articles/1_3_TwoSex_TimeInvariant_Age.html">Two-sex time-invariant model</a></li>
    <li><a class="dropdown-item" href="../articles/1_4_TwoSex_TimeVarying_Age.html">Two-sex time-varying model</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-models-by-age-and-stage" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Models by Age and Stage</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-models-by-age-and-stage">
<li><a class="dropdown-item" href="../articles/2_1_OneSex_TimeInvariant_AgeStage.html">One-sex time-invariant model</a></li>
    <li><a class="dropdown-item" href="../articles/2_2_TwoSex_TimeVarying_AgeStage.html">Two-sex time-varying model</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/IvanWilli/DemoKin"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Two-sex time-varying kinship model specified by age</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/IvanWilli/DemoKin/blob/main/vignettes/1_4_TwoSex_TimeVarying_Age.Rmd" class="external-link"><code>vignettes/1_4_TwoSex_TimeVarying_Age.Rmd</code></a></small>
      <div class="d-none name"><code>1_4_TwoSex_TimeVarying_Age.Rmd</code></div>
    </div>

    
    
<style>
/* Make TOC appear on the right side */
.tocify {
  position: fixed;
  top: 50px;
  right: 0;
  width: 240px;
  height: calc(100% - 50px);
  overflow-y: auto;
  margin-left: 0;
  padding-left: 0;
}

/* Adjust main content to make room for right-side TOC */
.main-container {
  max-width: calc(100% - 260px);
  margin-left: 10px;
  margin-right: 250px;
}

/* Limit TOC to only show 2 levels */
.tocify-subheader .tocify-subheader {
  display: none;
}

/* Style for learning objectives box */
.learning-objectives {
  background-color: #e0f7fa;
  border-left: 5px solid #00acc1;
  padding: 15px;
  margin-bottom: 20px;
  border-radius: 3px;
}
</style>
<div class="learning-objectives">
<p><strong>Learning Objectives</strong>: In this vignette, you will
learn how to implement a kinship model that combines both two-sex and
time-varying approaches. You will understand how to incorporate
sex-specific demographic rates that change over time, analyze the
effects of demographic transition on kinship structures by sex, and
explore approximation methods when data is limited.</p>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Family networks are shaped simultaneously by two fundamental forces:
demographic differences between males and females, and historical
changes in demographic rates over time. While previous vignettes have
explored these dimensions separately, this vignette integrates them into
a more comprehensive framework: a <strong>two-sex time-varying kinship
model</strong>, outlined in Caswell <span class="citation">(2022)</span>, using the <code>kin2sex</code> function
with <code>time_invariant = FALSE</code>.</p>
<div class="section level3">
<h3 id="preparation">Package Installation<a class="anchor" aria-label="anchor" href="#preparation"></a>
</h3>
<p>If you haven’t already installed the required packages from the
previous vignettes, here’s what you’ll need:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install basic data analysis packages</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"dplyr"</span><span class="op">)</span>     <span class="co"># Data manipulation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"tidyr"</span><span class="op">)</span>     <span class="co"># Data tidying</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"ggplot2"</span><span class="op">)</span>   <span class="co"># Data visualization</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"knitr"</span><span class="op">)</span>     <span class="co"># Document generation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"data.table"</span><span class="op">)</span><span class="co"># Efficient data handling</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"Matrix"</span><span class="op">)</span>    <span class="co"># Matrix operations</span></span>
<span></span>
<span><span class="co"># Install DemoKin</span></span>
<span><span class="co"># DemoKin is available on CRAN (https://cran.r-project.org/web/packages/DemoKin/index.html), </span></span>
<span><span class="co"># but we'll use the development version on GitHub (https://github.com/IvanWilli/DemoKin):</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"IvanWilli/DemoKin"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/IvanWilli/DemoKin" class="external-link">DemoKin</a></span><span class="op">)</span>  <span class="co"># For kinship analysis</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="load-packages">Setting Up the Analysis Environment<a class="anchor" aria-label="anchor" href="#load-packages"></a>
</h2>
<p>Let’s load the necessary packages for our analysis:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>    <span class="co"># For data manipulation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span>    <span class="co"># For restructuring data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>  <span class="co"># For visualization</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span>    <span class="co"># For document generation</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model-overview">Two-Sex Time-Varying Kinship Models<a class="anchor" aria-label="anchor" href="#model-overview"></a>
</h2>
<div class="section level3">
<h3 id="model-structure-and-components">Model Structure and Components<a class="anchor" aria-label="anchor" href="#model-structure-and-components"></a>
</h3>
<p>The combined two-sex time-varying kinship model expands on previous
models by requiring:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Sex-specific mortality rates over time</strong>: How
survival differs between males and females across historical
periods</li>
<li>
<strong>Sex-specific fertility rates over time</strong>: How
fertility patterns differ between males and females across historical
periods</li>
<li>
<strong>Sex ratio at birth</strong>: The proportion of births that
are female</li>
<li>
<strong>Sex of the focal individual</strong>: Whether we’re
analyzing male or female kinship networks</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="model-input-2sex-time-varying">Data Preparation<a class="anchor" aria-label="anchor" href="#model-input-2sex-time-varying"></a>
</h2>
<p>For this vignette, we’ll use Swedish demographic data from the
<code>DemoKin</code> package. However, since the package only includes
female fertility and mortality data over time, we’ll create synthetic
male rates for illustration purposes.</p>
<p>In a real-world application, you would ideally use actual male rates.
Here, we’ll create male rates by applying transformations to the female
rates:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract dimensions of the data</span></span>
<span><span class="va">years</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">swe_px</span><span class="op">)</span></span>
<span><span class="va">ages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">swe_px</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use female rates directly from the package</span></span>
<span><span class="va">swe_surv_f_matrix</span> <span class="op">&lt;-</span> <span class="va">swe_px</span></span>
<span><span class="va">swe_fert_f_matrix</span> <span class="op">&lt;-</span> <span class="va">swe_asfr</span></span>
<span></span>
<span><span class="co"># Create synthetic male rates</span></span>
<span><span class="co"># Male survival: Lower than female (raising to power 1.5 reduces values)</span></span>
<span><span class="va">swe_surv_m_matrix</span> <span class="op">&lt;-</span> <span class="va">swe_px</span> <span class="op">^</span> <span class="fl">1.5</span> <span class="co"># artificial perturbation for this example</span></span>
<span></span>
<span><span class="co"># Male fertility: Shifted to slightly older ages and slightly higher</span></span>
<span><span class="va">swe_fert_m_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="va">years</span><span class="op">)</span>,  </span>
<span>                          <span class="va">swe_asfr</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="op">(</span><span class="va">ages</span><span class="op">-</span><span class="fl">4</span><span class="op">)</span><span class="op">:</span><span class="va">ages</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1.05</span> <span class="co"># artificial perturbation for this example</span></span></code></pre></div>
<p>Let’s examine the resulting rates for a specific year (1900) to
verify they follow expected patterns:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">100</span>, sex <span class="op">=</span> <span class="st">"Female"</span>, component <span class="op">=</span> <span class="st">"Fertility rate"</span>, value <span class="op">=</span> <span class="va">swe_fert_f_matrix</span><span class="op">[</span>,<span class="st">"1900"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">100</span>, sex <span class="op">=</span> <span class="st">"Male"</span>, component <span class="op">=</span> <span class="st">"Fertility rate"</span>, value <span class="op">=</span> <span class="va">swe_fert_m_matrix</span><span class="op">[</span>,<span class="st">"1900"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">100</span>, sex <span class="op">=</span> <span class="st">"Female"</span>, component <span class="op">=</span> <span class="st">"Survival probability"</span>, value <span class="op">=</span> <span class="va">swe_surv_f_matrix</span><span class="op">[</span>,<span class="st">"1900"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">100</span>, sex <span class="op">=</span> <span class="st">"Male"</span>, component <span class="op">=</span> <span class="st">"Survival probability"</span>, value <span class="op">=</span> <span class="va">swe_surv_m_matrix</span><span class="op">[</span>,<span class="st">"1900"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">value</span>, col <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">component</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Sex-specific demographic rates in Sweden (1900)"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Age"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Rate"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Sex"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="1_4_TwoSex_TimeVarying_Age_files/figure-html/unnamed-chunk-2-1.png" width="2400" style="display: block; margin: auto;"></p>
<p><strong>Interpretation</strong>: The plot confirms our synthetic
rates follow expected patterns:</p>
<ul>
<li>
<strong>Fertility</strong>: Male fertility is shifted to slightly
older ages compared to female fertility</li>
<li>
<strong>Survival</strong>: Male survival probabilities are lower
than female survival at all ages</li>
<li>
<strong>Both rates</strong> show characteristic age patterns:
fertility concentrated in reproductive ages, and survival declining with
age</li>
</ul>
</div>
<div class="section level2">
<h2 id="run-model-2sex-time-varying">Running the Two-Sex Time-Varying Model<a class="anchor" aria-label="anchor" href="#run-model-2sex-time-varying"></a>
</h2>
<p>Now, let’s implement the two-sex time-varying kinship model using the
<code>kin2sex</code> function with
<code>time_invariant = FALSE</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kin_out_time_varying</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/kin2sex.html">kin2sex</a></span><span class="op">(</span></span>
<span>  pf <span class="op">=</span> <span class="va">swe_surv_f_matrix</span>,       <span class="co"># Female survival matrix (age x year)</span></span>
<span>  pm <span class="op">=</span> <span class="va">swe_surv_m_matrix</span>,       <span class="co"># Male survival matrix (age x year)</span></span>
<span>  ff <span class="op">=</span> <span class="va">swe_fert_f_matrix</span>,       <span class="co"># Female fertility matrix (age x year)</span></span>
<span>  fm <span class="op">=</span> <span class="va">swe_fert_m_matrix</span>,       <span class="co"># Male fertility matrix (age x year)</span></span>
<span>  sex_focal <span class="op">=</span> <span class="st">"f"</span>,              <span class="co"># Focal individual is female</span></span>
<span>  time_invariant <span class="op">=</span> <span class="cn">FALSE</span>,       <span class="co"># Use time-varying model</span></span>
<span>  birth_female <span class="op">=</span> <span class="fl">.5</span>,            <span class="co"># Sex ratio at birth (50% female)</span></span>
<span>  output_cohort <span class="op">=</span> <span class="fl">1900</span>          <span class="co"># Focus on the 1900 birth cohort</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The resulting output provides detailed information on the kinship
network for the 1900 female birth cohort, with relatives classified by
both age and sex.</p>
</div>
<div class="section level2">
<h2 id="kin-availability-2sex-time-varying">Comparing Time-Varying and Time-Invariant Models<a class="anchor" aria-label="anchor" href="#kin-availability-2sex-time-varying"></a>
</h2>
<p>To understand the impact of incorporating historical demographic
change, let’s compare the time-varying model with a time-invariant model
that uses only 1900 rates:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run a time-invariant model using only 1900 rates</span></span>
<span><span class="va">kin_out_time_invariant</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/kin2sex.html">kin2sex</a></span><span class="op">(</span></span>
<span>  pf <span class="op">=</span> <span class="va">swe_surv_f_matrix</span><span class="op">[</span>,<span class="st">"1900"</span><span class="op">]</span>,    <span class="co"># Female survival (1900)</span></span>
<span>  pm <span class="op">=</span> <span class="va">swe_surv_m_matrix</span><span class="op">[</span>,<span class="st">"1900"</span><span class="op">]</span>,    <span class="co"># Male survival (1900)</span></span>
<span>  ff <span class="op">=</span> <span class="va">swe_fert_f_matrix</span><span class="op">[</span>,<span class="st">"1900"</span><span class="op">]</span>,    <span class="co"># Female fertility (1900) </span></span>
<span>  fm <span class="op">=</span> <span class="va">swe_fert_m_matrix</span><span class="op">[</span>,<span class="st">"1900"</span><span class="op">]</span>,    <span class="co"># Male fertility (1900)</span></span>
<span>  sex_focal <span class="op">=</span> <span class="st">"f"</span>,                    <span class="co"># Focal individual is female</span></span>
<span>  birth_female <span class="op">=</span> <span class="fl">.5</span>                   <span class="co"># Sex ratio at birth (50% female)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine and plot the results</span></span>
<span><span class="va">kin_out_time_varying</span><span class="op">$</span><span class="va">kin_summary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cohort</span> <span class="op">==</span> <span class="fl">1900</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"variant"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">kin_out_time_invariant</span><span class="op">$</span><span class="va">kin_summary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"invariant"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># Combine siblings and aunts/uncles for simplicity</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>kin <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">kin</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ys"</span>, <span class="st">"os"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"s"</span>,</span>
<span>                         <span class="va">kin</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ya"</span>, <span class="st">"oa"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"a"</span>,</span>
<span>                         <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">kin</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Select key relationships</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">kin</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"d"</span>, <span class="st">"m"</span>, <span class="st">"gm"</span>, <span class="st">"ggm"</span>, <span class="st">"s"</span>, <span class="st">"a"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Group by relationship type, age, sex, and model type</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">type</span>, <span class="va">kin</span>, <span class="va">age_focal</span>, <span class="va">sex_kin</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">count_living</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Create plot</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">age_focal</span>, <span class="va">count</span>, linetype <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">kin</span><span class="op">)</span>, rows <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">sex_kin</span><span class="op">)</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Time-varying vs. time-invariant kinship models by sex"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Female 1900 birth cohort, Sweden"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Age of focal individual"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Number of living relatives"</span>,</span>
<span>    linetype <span class="op">=</span> <span class="st">"Model type"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="1_4_TwoSex_TimeVarying_Age_files/figure-html/unnamed-chunk-4-1.png" width="2400" style="display: block; margin: auto;"></p>
<p><strong>Interpretation</strong>: This comparison reveals important
differences between time-varying and time-invariant models:</p>
<ul>
<li>
<strong>Relatives by sex</strong>: The differences are pronounced
for both male kin (bottom row) and female kin (top row), where mortality
improvements over time led to greater availability than predicted by the
time-invariant model</li>
<li>
<strong>Ascending generations</strong>: For parents (m),
grandparents (gm), and great-grandparents (ggm), the time-varying model
shows higher kin availability at older ages, reflecting mortality
improvements not captured by the time-invariant model</li>
<li>
<strong>Descendants</strong>: For children (d), the time-varying
model shows fewer kin, reflecting fertility decline over time</li>
<li>
<strong>Kin of same generation</strong>: For siblings (s), fertility
decline over time has limited impact on their numbers because these
fertility events have either already occurred or will occur very
shortly. Instead, mortality improvements play a more critical role,
leading the time-varying model to predict a higher number of surviving
siblings at older ages.</li>
</ul>
<p>The time-varying model captures the demographic transition that
occurred over the 20th century, including declining fertility and
mortality rates. This produces a more accurate representation of kinship
dynamics for historical cohorts.</p>
</div>
<div class="section level2">
<h2 id="approximations">Approximation Methods for Limited Data<a class="anchor" aria-label="anchor" href="#approximations"></a>
</h2>
<p>In practice, demographic data is often limited, particularly for male
fertility rates which can be difficult to obtain. Caswell <span class="citation">(2022)</span> introduced two approximation methods to
estimate two-sex kinship networks when male demographic rates are
unavailable:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Androgynous approximation</strong>: Assumes equal fertility
and survival for males and females</li>
<li>
<strong>GKP factors</strong>: Applies multipliers to one-sex kin
counts based on theoretical considerations in Goodman, Keyfitz and
Pullum <span class="citation">(2022)</span>
</li>
</ol>
<p>Let’s evaluate these approximations using French data from the
<code>DemoKin</code> package:</p>
<div class="section level3">
<h3 id="androgynous">Androgynous Approximation<a class="anchor" aria-label="anchor" href="#androgynous"></a>
</h3>
<p>The androgynous approximation uses female rates for both sexes. Let’s
compare it to the full two-sex model:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load data of France again</span></span>
<span><span class="va">fra_fert_f</span> <span class="op">&lt;-</span> <span class="va">fra_asfr_sex</span><span class="op">[</span>,<span class="st">"ff"</span><span class="op">]</span>    <span class="co"># Female fertility rates</span></span>
<span><span class="va">fra_fert_m</span> <span class="op">&lt;-</span> <span class="va">fra_asfr_sex</span><span class="op">[</span>,<span class="st">"fm"</span><span class="op">]</span>    <span class="co"># Male fertility rates</span></span>
<span><span class="va">fra_surv_f</span> <span class="op">&lt;-</span> <span class="va">fra_surv_sex</span><span class="op">[</span>,<span class="st">"pf"</span><span class="op">]</span>    <span class="co"># Female survival probabilities</span></span>
<span><span class="va">fra_surv_m</span> <span class="op">&lt;-</span> <span class="va">fra_surv_sex</span><span class="op">[</span>,<span class="st">"pm"</span><span class="op">]</span>    <span class="co"># Male survival probabilities</span></span>
<span></span>
<span><span class="co"># Full two-sex model</span></span>
<span><span class="va">kin_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/kin2sex.html">kin2sex</a></span><span class="op">(</span><span class="va">fra_surv_f</span>, <span class="va">fra_surv_m</span>, <span class="va">fra_fert_f</span>, <span class="va">fra_fert_m</span>, </span>
<span>                  sex_focal <span class="op">=</span> <span class="st">"f"</span>, birth_female <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Androgynous approximation</span></span>
<span><span class="va">kin_out_androgynous</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/kin2sex.html">kin2sex</a></span><span class="op">(</span><span class="va">fra_surv_f</span>, <span class="va">fra_surv_f</span>, <span class="va">fra_fert_f</span>, <span class="va">fra_fert_f</span>, </span>
<span>                              sex_focal <span class="op">=</span> <span class="st">"f"</span>, birth_female <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare the results</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="va">kin_out</span><span class="op">$</span><span class="va">kin_summary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"full"</span><span class="op">)</span>,</span>
<span>  <span class="va">kin_out_androgynous</span><span class="op">$</span><span class="va">kin_summary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"androgynous"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">kin</span>, <span class="va">age_focal</span>, <span class="va">sex_kin</span>, <span class="va">type</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">count_living</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">age_focal</span>, <span class="va">count</span>, linetype <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>, axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>row <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">sex_kin</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">kin</span><span class="op">)</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Androgynous approximation vs. full two-sex model"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"France, 2012"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Age of focal individual"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Number of living relatives"</span>,</span>
<span>    linetype <span class="op">=</span> <span class="st">"Model type"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="1_4_TwoSex_TimeVarying_Age_files/figure-html/unnamed-chunk-5-1.png" width="2400" style="display: block; margin: auto;"></p>
<p><strong>Interpretation</strong>: The androgynous approximation
performs well for most kin types, particularly for female relatives.
However, it shows noticeable discrepancies for most types of male
relatives, where ignoring male-specific mortality leads to
overestimation.</p>
</div>
<div class="section level3">
<h3 id="gkp">GKP Factors Approximation<a class="anchor" aria-label="anchor" href="#gkp"></a>
</h3>
<p>The GKP factors approach applies theoretical multipliers to one-sex
kin counts. Let’s implement and evaluate this approach:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># One-sex model</span></span>
<span><span class="va">kin_out_1sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/kin.html">kin</a></span><span class="op">(</span><span class="va">fra_surv_f</span>, <span class="va">fra_fert_f</span>, birth_female <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply GKP factors</span></span>
<span><span class="va">kin_out_GKP</span> <span class="op">&lt;-</span> <span class="va">kin_out_1sex</span><span class="op">$</span><span class="va">kin_summary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>count_living <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">kin</span> <span class="op">==</span> <span class="st">"m"</span> <span class="op">~</span> <span class="va">count_living</span> <span class="op">*</span> <span class="fl">2</span>,          <span class="co"># Parents: multiply by 2</span></span>
<span>    <span class="va">kin</span> <span class="op">==</span> <span class="st">"gm"</span> <span class="op">~</span> <span class="va">count_living</span> <span class="op">*</span> <span class="fl">4</span>,         <span class="co"># Grandparents: multiply by 4</span></span>
<span>    <span class="va">kin</span> <span class="op">==</span> <span class="st">"ggm"</span> <span class="op">~</span> <span class="va">count_living</span> <span class="op">*</span> <span class="fl">8</span>,        <span class="co"># Great-grandparents: multiply by 8</span></span>
<span>    <span class="va">kin</span> <span class="op">==</span> <span class="st">"d"</span> <span class="op">~</span> <span class="va">count_living</span> <span class="op">*</span> <span class="fl">2</span>,          <span class="co"># Children: multiply by 2</span></span>
<span>    <span class="va">kin</span> <span class="op">==</span> <span class="st">"gd"</span> <span class="op">~</span> <span class="va">count_living</span> <span class="op">*</span> <span class="fl">4</span>,         <span class="co"># Grandchildren: multiply by 4</span></span>
<span>    <span class="va">kin</span> <span class="op">==</span> <span class="st">"ggd"</span> <span class="op">~</span> <span class="va">count_living</span> <span class="op">*</span> <span class="fl">4</span>,        <span class="co"># Great-grandchildren: multiply by 4</span></span>
<span>    <span class="va">kin</span> <span class="op">==</span> <span class="st">"oa"</span> <span class="op">~</span> <span class="va">count_living</span> <span class="op">*</span> <span class="fl">4</span>,         <span class="co"># Older aunts/uncles: multiply by 4</span></span>
<span>    <span class="va">kin</span> <span class="op">==</span> <span class="st">"ya"</span> <span class="op">~</span> <span class="va">count_living</span> <span class="op">*</span> <span class="fl">4</span>,         <span class="co"># Younger aunts/uncles: multiply by 4</span></span>
<span>    <span class="va">kin</span> <span class="op">==</span> <span class="st">"os"</span> <span class="op">~</span> <span class="va">count_living</span> <span class="op">*</span> <span class="fl">2</span>,         <span class="co"># Older siblings: multiply by 2</span></span>
<span>    <span class="va">kin</span> <span class="op">==</span> <span class="st">"ys"</span> <span class="op">~</span> <span class="va">count_living</span> <span class="op">*</span> <span class="fl">2</span>,         <span class="co"># Younger siblings: multiply by 2</span></span>
<span>    <span class="va">kin</span> <span class="op">==</span> <span class="st">"coa"</span> <span class="op">~</span> <span class="va">count_living</span> <span class="op">*</span> <span class="fl">8</span>,        <span class="co"># Cousins (older): multiply by 8</span></span>
<span>    <span class="va">kin</span> <span class="op">==</span> <span class="st">"cya"</span> <span class="op">~</span> <span class="va">count_living</span> <span class="op">*</span> <span class="fl">8</span>,        <span class="co"># Cousins (younger): multiply by 8</span></span>
<span>    <span class="va">kin</span> <span class="op">==</span> <span class="st">"nos"</span> <span class="op">~</span> <span class="va">count_living</span> <span class="op">*</span> <span class="fl">4</span>,        <span class="co"># Nieces/nephews (older): multiply by 4</span></span>
<span>    <span class="va">kin</span> <span class="op">==</span> <span class="st">"nys"</span> <span class="op">~</span> <span class="va">count_living</span> <span class="op">*</span> <span class="fl">4</span>         <span class="co"># Nieces/nephews (younger): multiply by 4</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare approaches at selected ages</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="va">kin_out</span><span class="op">$</span><span class="va">kin_summary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"full"</span><span class="op">)</span>,</span>
<span>  <span class="va">kin_out_androgynous</span><span class="op">$</span><span class="va">kin_summary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"androgynous"</span><span class="op">)</span>,</span>
<span>  <span class="va">kin_out_GKP</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"gkp"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Combine siblings, aunts/uncles, cousins, and nieces/nephews</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>kin <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">kin</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ys"</span>, <span class="st">"os"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"s"</span>,           <span class="co"># All siblings</span></span>
<span>    <span class="va">kin</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ya"</span>, <span class="st">"oa"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"a"</span>,           <span class="co"># All aunts/uncles</span></span>
<span>    <span class="va">kin</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"coa"</span>, <span class="st">"cya"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"c"</span>,         <span class="co"># All cousins</span></span>
<span>    <span class="va">kin</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"nys"</span>, <span class="st">"nos"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"n"</span>,         <span class="co"># All nieces/nephews</span></span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">kin</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Select specific ages for comparison</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">age_focal</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">15</span>, <span class="fl">30</span>, <span class="fl">60</span>, <span class="fl">80</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Sum across sex for total kin counts</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">kin</span>, <span class="va">age_focal</span>, <span class="va">type</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">count_living</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Create bar chart</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">type</span>, <span class="va">count</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">type</span><span class="op">)</span>, stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>col <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">kin</span><span class="op">)</span>, row <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">age_focal</span><span class="op">)</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Comparison of approximation methods with full two-sex model"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"France, 2012, at selected ages"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Approximation method"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Total number of living relatives"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Method"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="1_4_TwoSex_TimeVarying_Age_files/figure-html/unnamed-chunk-6-1.png" width="2400" style="display: block; margin: auto;"></p>
<p><strong>Interpretation</strong>: This comparison shows that both
approximation methods produce reasonable estimates for most kin types.
Overall, these approximations offer practical alternatives when
sex-specific data is limited, though they should be used with caution
and their limitations understood.</p>
</div>
</div>
<div class="section level2">
<h2 id="prevalance-2sex-time-varying">Incorporating Causes of Death<a class="anchor" aria-label="anchor" href="#prevalance-2sex-time-varying"></a>
</h2>
<p>The <code>kin2sex</code> function also allows for the analysis of
kinship networks by cause of death, providing insights into how
different mortality causes affect kin availability. More details about
kin bereavement methodology can be found in Caswell, Margolis and
Verdery <span class="citation">(2023)</span>. Let’s implement a simple
cause-of-death model with two competing causes.</p>
<p>Now assume we have two causes of death (COD). For females, the risk
of the first COD is half the risk of the second COD for ages greater
than 50. For males, the risk of the first COD is 2/3 of the second COD
for ages greater than 50. We operationalize this using two matrices with
dimension 2 by 101 (number of causes by number of ages).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create matrices of relative risks by cause, sex, and age</span></span>
<span><span class="va">Hf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="fl">1</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">fra_surv_f</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Female risk factors</span></span>
<span><span class="va">Hm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.33</span>, <span class="fl">1</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">fra_surv_f</span><span class="op">)</span><span class="op">)</span> <span class="co"># Male risk factors</span></span>
<span></span>
<span><span class="co"># Set equal risks for ages below 50</span></span>
<span><span class="va">Hf</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">50</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Hm</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">50</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></code></pre></div>
<p>Now we’ll run the two-sex model with cause of death information:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kin_out_cod_invariant</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/kin2sex.html">kin2sex</a></span><span class="op">(</span></span>
<span>  pf <span class="op">=</span> <span class="va">fra_surv_f</span>,           <span class="co"># Female survival</span></span>
<span>  pm <span class="op">=</span> <span class="va">fra_surv_m</span>,           <span class="co"># Male survival</span></span>
<span>  ff <span class="op">=</span> <span class="va">fra_fert_f</span>,           <span class="co"># Female fertility</span></span>
<span>  fm <span class="op">=</span> <span class="va">fra_fert_m</span>,           <span class="co"># Male fertility</span></span>
<span>  Hf <span class="op">=</span> <span class="va">Hf</span>,                   <span class="co"># Female cause-specific risk factors</span></span>
<span>  Hm <span class="op">=</span> <span class="va">Hm</span>,                   <span class="co"># Male cause-specific risk factors</span></span>
<span>  time_invariant <span class="op">=</span> <span class="cn">TRUE</span>      <span class="co"># Using time-invariant model for simplicity</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Let’s examine the structure of the output:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">kin_out_cod_invariant</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 9</span></span></span>
<span><span class="co">##   year  cohort age_focal sex_kin kin   age_kin living deadcause1 deadcause2</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>             0 f       d           0      0          0          0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>             1 f       d           0      0          0          0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>             2 f       d           0      0          0          0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>             3 f       d           0      0          0          0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>             4 f       d           0      0          0          0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>             5 f       d           0      0          0          0</span></span></code></pre>
<p>The output now includes additional columns for each cause of death.
Let’s visualize the distribution of parental deaths by cause, sex, and
age for a 30-year-old Focal:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kin_out_cod_invariant</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">kin</span> <span class="op">==</span> <span class="st">"m"</span>, <span class="va">age_focal</span> <span class="op">==</span> <span class="fl">30</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>deadcause1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">deadcause1</span><span class="op">)</span>,</span>
<span>            deadcause2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">deadcause2</span><span class="op">)</span>, .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">age_kin</span>, <span class="va">sex_kin</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="va">deadcause1</span><span class="op">:</span><span class="va">deadcause2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">age_kin</span>, <span class="va">value</span>, col <span class="op">=</span> <span class="va">sex_kin</span>, linetype <span class="op">=</span> <span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Distribution of parental deaths by cause, sex, and age"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"For a 30-year-old focal individual"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Age of parent at death"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Expected number of parental deaths"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Sex of parent"</span>,</span>
<span>    linetype <span class="op">=</span> <span class="st">"Cause of death"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="1_4_TwoSex_TimeVarying_Age_files/figure-html/unnamed-chunk-10-1.png" width="2400" style="display: block; margin: auto;"></p>
<p><strong>Interpretation</strong>: This visualization shows the
distribution of parental deaths by cause:</p>
<ul>
<li>
<strong>Timing</strong>: In this simplified example, all parental
deaths occur after age 50</li>
<li>
<strong>Sex differences</strong>: Male parents (fathers) show higher
death counts at earlier ages, reflecting their higher mortality</li>
<li>
<strong>Cause differences</strong>: The relative importance of
different causes varies by sex, with males showing a different
distribution than females</li>
</ul>
<p>This approach can be extended to include more causes of death and to
incorporate time-varying cause-specific mortality, though this would
require more complex data inputs.</p>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>In this vignette, we’ve explored how to implement two-sex
time-varying kinship models using the <code>DemoKin</code> package.
These models provide a more comprehensive framework for understanding
kinship dynamics by incorporating both sex differences and historical
demographic change.</p>
<p>Key insights include:</p>
<ol style="list-style-type: decimal">
<li>Time-varying models capture the effects of demographic transition on
kinship networks</li>
<li>Sex-specific models reveal important differences in the availability
of male versus female relatives</li>
<li>Approximation methods offer practical alternatives when data is
limited</li>
<li>Cause-of-death extensions provide insights into how different
mortality causes shape kinship structures</li>
</ol>
<p>These advanced models enhance our understanding of gender and family
dynamics across demographic transitions, offering valuable tools for
demographic analysis, care planning, and social policy development in
aging societies.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-caswell_formal_2022" class="csl-entry">
Caswell, Hal. 2022. <span>“The Formal Demography of Kinship
<span>IV</span>: <span>Two</span>-Sex Models and Their
Approximations.”</span> <em>Demographic Research</em> 47 (September):
359–96. <a href="https://doi.org/10.4054/DemRes.2022.47.13" class="external-link">https://doi.org/10.4054/DemRes.2022.47.13</a>.
</div>
<div id="ref-Caswell2023" class="csl-entry">
Caswell, Hal, Rachel Margolis, and Ashton Verdery. 2023. <span>“<span class="nocase">The formal demography of kinship V: Kin loss,
bereavement, and causes of death</span>.”</span> <em>Demographic
Research</em> 49 (December): 1163–1200. <a href="https://www.demographic-research.org/articles/volume/49/41" class="external-link">https://www.demographic-research.org/articles/volume/49/41</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Iván Williams, Diego Alburez-Gutierrez.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
